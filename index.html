<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Form Ranting Modern</title>

<!-- Tom Select CSS -->
<link href="https://cdn.jsdelivr.net/npm/tom-select/dist/css/tom-select.css" rel="stylesheet">

<style>
body {
  font-family: 'Segoe UI', sans-serif;
  background: linear-gradient(135deg, #4e73df, #1cc88a);
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
  margin: 0;
}

/* Loading Fullscreen */
#pageLoader {
  position: fixed;
  width: 100%;
  height: 100%;
  background: linear-gradient(135deg, #4e73df, #1cc88a);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 9999;
  color: white;
  font-size: 18px;
  flex-direction: column;
}

.loader-ring {
  border: 6px solid rgba(255,255,255,0.3);
  border-top: 6px solid white;
  border-radius: 50%;
  width: 60px;
  height: 60px;
  animation: spin 1s linear infinite;
  margin-bottom: 15px;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

.card {
  background: white;
  padding: 30px;
  border-radius: 15px;
  width: 100%;
  max-width: 420px;
  box-shadow: 0 15px 40px rgba(0,0,0,0.2);
  display: none;
}

h2 {
  text-align: center;
}

input, textarea, select {
  width: 100%;
  padding: 12px;
  margin-bottom: 15px;
  border-radius: 8px;
  border: 1px solid #ddd;
  font-size: 14px;
}

button {
  width: 100%;
  padding: 12px;
  border: none;
  border-radius: 8px;
  background: #4e73df;
  color: white;
  font-size: 16px;
  cursor: pointer;
  position: relative;
}

button:disabled {
  background: gray;
}

.spinner {
  border: 3px solid #f3f3f3;
  border-top: 3px solid white;
  border-radius: 50%;
  width: 18px;
  height: 18px;
  animation: spin 1s linear infinite;
  position: absolute;
  right: 15px;
  top: 50%;
  transform: translateY(-50%);
  display: none;
}

.success, .error {
  padding: 10px;
  border-radius: 8px;
  text-align: center;
  margin-top: 10px;
  display: none;
}

.success { background: #d4edda; color: #155724; }
.error { background: #f8d7da; color: #721c24; }

</style>
</head>
<body>

<!-- Loading Screen -->
<div id="pageLoader">
  <div class="loader-ring"></div>
  Memuat data ranting...
</div>

<div class="card" id="formCard">
  <h2>Form Pendaftaran</h2>

  <form id="myForm">
    <input type="text" name="nama" placeholder="Nama Lengkap" required>

    <select id="rantingSelect" name="ranting" placeholder="Cari Ranting..." required></select>

    <textarea name="pesan" placeholder="Tulis pesan..." rows="4" required></textarea>

    <button type="submit" id="submitBtn">
      Kirim
      <div class="spinner" id="spinner"></div>
    </button>
  </form>

  <div class="success" id="successMsg">‚úÖ Data berhasil dikirim!</div>
  <div class="error" id="errorMsg">‚ùå Terjadi kesalahan.</div>
</div>

<!-- Tom Select JS -->
<script src="https://cdn.jsdelivr.net/npm/tom-select/dist/js/tom-select.complete.min.js"></script>

<script>
const scriptURL = "https://script.google.com/macros/s/AKfycbzjDJAttqnocj7nC93mKqRBI5bt7MgT4lRb87Q7b2rF7HqlFtMQlA8uKZwofy-LpmhMug/exec";

const loader = document.getElementById("pageLoader");
const card = document.getElementById("formCard");
const rantingSelect = document.getElementById("rantingSelect");
const form = document.getElementById("myForm");
const button = document.getElementById("submitBtn");
const spinner = document.getElementById("spinner");
const successMsg = document.getElementById("successMsg");
const errorMsg = document.getElementById("errorMsg");

/* =========================
   LOAD DATA RANTING
========================= */

fetch(scriptURL + "?action=get")
  .then(res => res.json())
  .then(dataList => {
    dataList.forEach(ranting => {
      let option = document.createElement("option");
      option.value = ranting;
      option.textContent = ranting;
      rantingSelect.appendChild(option);
    });

    new TomSelect("#rantingSelect", {
      create: false,
      sortField: { field: "text", direction: "asc" }
    });

    loader.style.display = "none";
    card.style.display = "block";
  })
  .catch(() => {
    loader.innerHTML = "Gagal memuat data üò¢";
  });

/* =========================
   SUBMIT FORM
========================= */

form.addEventListener("submit", function(e) {
  e.preventDefault();

  successMsg.style.display = "none";
  errorMsg.style.display = "none";
  button.disabled = true;
  spinner.style.display = "block";

  const formData = new FormData(form);
  const data = Object.fromEntries(formData.entries());

  fetch(scriptURL, {
    method: "POST",
    mode: "no-cors",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify(data)
  })
  .then(() => {
    successMsg.style.display = "block";
    form.reset();
  })
  .catch(() => {
    errorMsg.style.display = "block";
  })
  .finally(() => {
    button.disabled = false;
    spinner.style.display = "none";
  });
});
</script>

</body>
</html>
